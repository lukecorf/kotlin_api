<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet author="lukecorf" id="001">
        <createTable tableName="COURSE" remarks="Save course info.">
            <column autoIncrement="true" name="ID" type="NUMBER" remarks="Primary key of Course table. Unique and generated by SEQ_COURSE">
                <constraints primaryKey="true"/>
            </column>
            <column name="NAME" type="VARCHAR(255)" remarks="Course name.">
                <constraints nullable="false"/>
            </column>
            <column name="CATEGORY" type="VARCHAR(255)" remarks="Course category.">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createSequence incrementBy="1" sequenceName="SEQ_COURSE" startValue="1"/>

        <rollback>
            <dropTable tableName="COURSE"/>
        </rollback>
    </changeSet>

    <changeSet author="lukecorf" id="002">
        <createTable tableName="USERS" remarks="Save user info.">
            <column autoIncrement="true" name="ID" type="NUMBER" remarks="Primary key of User table. Unique and generated by SEQ_USER">
                <constraints primaryKey="true"/>
            </column>
            <column name="NAME" type="VARCHAR(255)" remarks="User name.">
                <constraints nullable="false"/>
            </column>
            <column name="PASSWORD" type="VARCHAR(150)" remarks="User password.">
                <constraints nullable="false"/>
            </column>
            <column name="EMAIL" type="VARCHAR(255)" remarks="User e-mail."/>
        </createTable>

        <createSequence incrementBy="1" sequenceName="SEQ_USER" startValue="1"/>

        <rollback>
            <dropTable tableName="USERS"/>
        </rollback>
    </changeSet>

    <changeSet author="lukecorf" id="003">
        <createTable tableName="TOPIC" remarks="Save topic info.">
            <column autoIncrement="true" name="ID" type="NUMBER" remarks="Primary key of Topic table. Unique and generated by SEQ_TOPIC">
                <constraints primaryKey="true"/>
            </column>
            <column name="TITLE" type="VARCHAR(100)" remarks="Topic title.">
                <constraints nullable="false"/>
            </column>
            <column name="MESSAGE" type="VARCHAR(300)" remarks="Topic message.">
                <constraints nullable="false"/>
            </column>
            <column name="CREATION_DATE" type="TIMESTAMP" remarks="Topic creation date.">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR(20)" remarks="Topic status.">
                <constraints nullable="false"/>
            </column>
            <column name="COURSE_ID" type="NUMBER" remarks="Course linked with topic.">
                <constraints nullable="false"/>
            </column>
            <column name="AUTHOR_ID" type="NUMBER" remarks="Author of topic.">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createSequence incrementBy="1" sequenceName="SEQ_TOPIC" startValue="1"/>

        <addForeignKeyConstraint constraintName="TOPIC_COURSE_FK" baseTableName="TOPIC" baseColumnNames="COURSE_ID" referencedTableName="COURSE" referencedColumnNames="ID"/>
        <addForeignKeyConstraint constraintName="TOPIC_AUTHOR_FK" baseTableName="TOPIC" baseColumnNames="AUTHOR_ID" referencedTableName="USERS" referencedColumnNames="ID"/>

        <rollback>
            <dropTable tableName="TOPIC"/>
        </rollback>
    </changeSet>

    <changeSet author="lukecorf" id="004">
        <createTable tableName="ANSWERS" remarks="Save the topic answers.">
            <column autoIncrement="true" name="ID" type="NUMBER" remarks="Primary key of Answers table. Unique and generated by SEQ_ANSWERS">
                <constraints primaryKey="true"/>
            </column>
            <column name="MESSAGE" type="VARCHAR(300)" remarks="Answer message.">
                <constraints nullable="false"/>
            </column>
            <column name="CREATION_DATE" type="TIMESTAMP" remarks="Answer date.">
                <constraints nullable="false"/>
            </column>
            <column name="TOPIC_ID" type="NUMBER" remarks="Topic relationship.">
                <constraints nullable="false"/>
            </column>
            <column name="AUTHOR_ID" type="NUMBER" remarks="Answer author.">
                <constraints nullable="false"/>
            </column>
            <column name="SOLVED" type="NUMBER(1)" remarks="Answer solved the question?.">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createSequence incrementBy="1" sequenceName="SEQ_ANSWERS" startValue="1"/>

        <addForeignKeyConstraint constraintName="ANSWER_TOPIC_FK" baseTableName="ANSWERS" baseColumnNames="TOPIC_ID" referencedTableName="TOPIC" referencedColumnNames="ID"/>
        <addForeignKeyConstraint constraintName="ANSWER_AUTHOR_FK" baseTableName="ANSWERS" baseColumnNames="AUTHOR_ID" referencedTableName="USERS" referencedColumnNames="ID"/>

        <rollback>
            <dropTable tableName="ANSWERS"/>
        </rollback>
    </changeSet>

    <changeSet author="lukecorf" id="005">
        <createTable tableName="ROLES" remarks="Save the system roles.">
            <column autoIncrement="true" name="ID" type="NUMBER" remarks="Primary key of Roles table. Unique and generated by SEQ_ROLES">
                <constraints primaryKey="true"/>
            </column>
            <column name="NAME" type="VARCHAR(50)" remarks="Role name.">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createSequence incrementBy="1" sequenceName="SEQ_ROLES" startValue="1"/>

        <rollback>
            <dropTable tableName="ROLES"/>
        </rollback>
    </changeSet>

    <changeSet author="lukecorf" id="006">
        <createTable tableName="USERS_ROLES" remarks="Save link between user and roles.">
            <column name="ROLES_ID" type="NUMBER" remarks="Role ID.">
                <constraints nullable="false"/>
            </column>
            <column name="USERS_ID" type="NUMBER" remarks="User ID.">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey columnNames="ROLES_ID, USERS_ID" constraintName="USER_ROLE_PK" tableName="USERS_ROLES"/>

        <addForeignKeyConstraint constraintName="UR_ROLE_FK" baseTableName="USERS_ROLES" baseColumnNames="ROLES_ID" referencedTableName="ROLES" referencedColumnNames="ID"/>
        <addForeignKeyConstraint constraintName="UR_USER_FK" baseTableName="USERS_ROLES" baseColumnNames="USERS_ID" referencedTableName="USERS" referencedColumnNames="ID"/>

        <rollback>
            <dropTable tableName="USERS_ROLES"/>
        </rollback>

    </changeSet>

</databaseChangeLog>